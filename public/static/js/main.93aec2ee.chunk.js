(this["webpackJsonpreact-typescript"]=this["webpackJsonpreact-typescript"]||[]).push([[0],{86:function(e,t,a){e.exports=a(99)},97:function(e,t,a){},99:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(8),o=a(15),c=a(34);function i(e){return{type:"LOGIN",user:e}}var s={displayName:"",limit:0,used:0,photoLink:""},u={status:!1,user:s};var m=a(73);function d(e){return{type:"ADD",item:e}}function f(e,t){return{type:"UPDATE",item:t,index:e}}var h=[];var p=Object(c.b)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return{status:!0,user:t.user};case"LOGOUT":return{status:!1,user:s};default:return e}},transfers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD":return[].concat(Object(m.a)(e),[t.item]);case"UPDATE":return e.map((function(e,a){return a===t.index?t.item:e}));default:return e}}}),g=Object(c.c)(p),E=a(19),v=a.n(E),b=a(35),k=a(144),y=a(146),w=a(54),x=a(140),O=(a(97),a(138)),j=a(141),N=a(142),L=a(165),S=a(143),B="https://lace-observation.glitch.me/",C=function(e){return B+"user/?token="+e},I=function(e,t){return B+"file/"+t+"?token="+e},T=function(e,t){return B+"user/file/"+t+"?token="+e},D=function(){return window.localStorage.getItem("dtoken")},G=function(){return window.localStorage.getItem("dtokenExp")};function U(e){var t=e.match(/[-\w]{25,}/);return null==t?"":t[0]}function A(e,t,a,n){return M.apply(this,arguments)}function M(){return(M=Object(b.a)(v.a.mark((function e(t,a,n,r){var l,o,c,i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(l=D())){e.next=17;break}return o=T(l,String(a)),console.log(o),e.next=7,fetch(o);case 7:return c=e.sent,e.next=10,c.json();case 10:if(!(i=e.sent).success){e.next=16;break}return n(i.data,t),e.abrupt("return");case 16:r(i.error,t);case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),console.log("Error at createCopy",e.t0),r(e.t0,t);case 23:case"end":return e.stop()}}),e,null,[[0,19]])})))).apply(this,arguments)}function z(){var e,t=Object(o.c)((function(e){return e.auth.user})),a=Object(o.b)();return n.createElement("div",null,n.createElement(x.a,{color:"secondary",variant:"contained",style:{float:"right"},disableElevation:!0,onClick:function(){window.localStorage.removeItem("dtoken"),window.localStorage.removeItem("dtokenExp"),a({type:"LOGOUT"})}},"Logout"),n.createElement(j.a,null,n.createElement(N.a,null,n.createElement(L.a,{alt:"Remy Sharp",src:t.photoLink})),n.createElement(S.a,{primary:n.createElement(n.Fragment,null,n.createElement(w.a,{variant:"h6"},t.displayName)),secondary:(e=Math.floor(t.used/t.limit*100),n.createElement("div",null,n.createElement(O.a,{variant:"determinate",value:e})))})))}var P=a(44),W=a(145),F=a(147),_=a(161),J=a(164),R=a(163),Y=Object(k.a)({root:{display:"block",margin:"0 auto"},inputWidth:{maxWidth:300}});function q(e){return e.length>0&&U(e).length>0}function H(){var e=Y(),t=Object(W.a)("(max-width:600px)"),a=Object(n.useState)({url:"",validation:!1}),r=Object(P.a)(a,2),l=r[0],c=r[1],i=Object(n.useState)({show:!1,success:!1,message:""}),s=Object(P.a)(i,2),u=s[0],m=s[1],h=Object(o.b)(),p=function(){var e=Object(b.a)(v.a.mark((function e(){var t,a,n,r,o,c,i,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l.validation){e.next=27;break}if(t=U(l.url),console.log(t),!(a=D())){e.next=25;break}return n=I(a,t),console.log("URL:",n),e.next=9,fetch(n);case 9:return r=e.sent,e.next=12,r.json();case 12:if(!(o=e.sent).success){e.next=23;break}return c=o.data,i={id:c.id,name:c.name,size:Number(c.size),status:c.capabilities.canCopy?"fetched":"failed",error:c.capabilities.canCopy?"":"Copy is not permitted on this file"},s=g.getState().transfers.length,h(d(i)),m({show:!0,success:!0,message:"Started cloning"}),e.next=21,A(s,t,(function(e,t){var a=Object.assign({},i,{status:"copied",error:"",downloadLink:e.webContentLink,fileLink:e.alternateLink});h(f(t,a))}),(function(e,t){var a=Object.assign({},i,{status:"failed",error:e.toString()});h(f(t,a))}));case 21:e.next=25;break;case 23:m({show:!0,success:!1,message:o.error}),console.log("failed to connect");case 25:e.next=28;break;case 27:console.log("Url has errors");case 28:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(e,t){u.show&&(m(Object.assign({},u,{show:!1})),console.log("Closed notification"))};return n.createElement("div",null,n.createElement(y.a,{variant:"outlined"},n.createElement(F.a,{container:!0,alignItems:"center",spacing:0,style:{padding:8}},n.createElement(F.a,{item:!0,xs:!0,className:t?e.inputWidth:""},n.createElement(_.a,{id:"standard-error-helper-text",helperText:!l.validation&&l.url.length>0?"Invalid url":"",error:0!==l.url.length&&!l.validation,value:l.url,onChange:function(e){c({url:e.target.value,validation:q(e.target.value)}),console.log(e.target.value),console.log(q(e.target.value))},label:"Paste your drive link here",fullWidth:!0,InputProps:{disableUnderline:!0}})),n.createElement(F.a,{item:!0,xs:2},n.createElement(x.a,{disabled:0===l.url.length||!l.validation,variant:"outlined",color:"primary",href:"#outlined-buttons",style:{margin:8},onClick:p},"Copy")))),n.createElement(J.a,{open:u.show,autoHideDuration:1200,onClose:E},n.createElement(R.a,{onClose:E,severity:u.success?"success":"error"},u.message)))}var K=a(157),V=a(162),Z=a(155),Q=a(149),X=a(158),$=a(160),ee=a(154),te=a(156),ae=a(159),ne=a(153),re=a(72),le=a.n(re),oe=a(71),ce=a.n(oe),ie=a(150),se=a(151),ue=a(152),me=a(53),de=a(51),fe=a(52),he=Object(k.a)({root:{"& > *":{borderBottom:"unset"}}});var pe=function(e){var t,a=r.a.useState(!1),n=Object(P.a)(a,2),l=n[0],o=n[1],c=he();return r.a.createElement(r.a.Fragment,null,r.a.createElement(ne.a,{className:c.root},"fetched"!==e.status?r.a.createElement(ee.a,null,r.a.createElement(Q.a,{"aria-label":"expand row",size:"small",onClick:function(){return o(!l)}},l?r.a.createElement(ce.a,null):r.a.createElement(le.a,null))):r.a.createElement(ee.a,null),r.a.createElement(ee.a,{component:"th",scope:"row"},e.name),r.a.createElement(ee.a,{align:"right"},function(e,t){if(0===e)return"0 Bytes";var a=t||2,n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(a))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]}(e.size)),r.a.createElement(ee.a,{align:"right"},function(e){switch(e){case"copied":return r.a.createElement(ie.a,{style:{color:me.a[500]}});case"failed":return r.a.createElement(se.a,{style:{color:de.a[500]}});default:return r.a.createElement(ue.a,{style:{color:fe.a[500]}})}}(e.status))),r.a.createElement(ne.a,null,r.a.createElement(ee.a,{style:{paddingBottom:0,paddingTop:0},colSpan:6},r.a.createElement(Z.a,{in:l,timeout:"auto",unmountOnExit:!0},r.a.createElement(V.a,{margin:1},"failed"===e.status?r.a.createElement(w.a,{component:"div"},"row.error"):(t=e,r.a.createElement("div",null,r.a.createElement(F.a,{container:!0,direction:"row",spacing:2},r.a.createElement(F.a,{item:!0},r.a.createElement(x.a,{variant:"outlined",href:t.downloadLink,target:"_blank"},"Download")),r.a.createElement(F.a,{item:!0},r.a.createElement(x.a,{variant:"outlined",href:t.fileLink,target:"_blank"},"View"))))))))))};function ge(){var e=Object(o.c)((function(e){return e.transfers}));return r.a.createElement(te.a,{component:y.a},r.a.createElement(w.a,{variant:"h6",style:{margin:8}},"Transfers"),0===e.length?r.a.createElement(K.a,null,r.a.createElement(w.a,null,"Nothing started")):r.a.createElement(X.a,{"aria-label":"collapsible table"},r.a.createElement(ae.a,null,r.a.createElement(ne.a,null,r.a.createElement(ee.a,null),r.a.createElement(ee.a,null,"Name"),r.a.createElement(ee.a,{align:"right"},"Size"),r.a.createElement(ee.a,{align:"right"},"Status"))),r.a.createElement($.a,null,e.map((function(e,t){return r.a.createElement(pe,Object.assign({key:t},e))})))))}var Ee=Object(k.a)({root:{margin:20,padding:16},authButton:{display:"block",margin:"0 auto",width:110}});function ve(e,t,a){return be.apply(this,arguments)}function be(){return(be=Object(b.a)(v.a.mark((function e(t,a,n){var r,l,o,c,i,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=D(),l=G(),!r||!l){e.next=25;break}if(!((o=+new Date)/1e3<Number(l))){e.next=23;break}return e.prev=5,e.next=8,fetch(C(r));case 8:if(200!==(c=e.sent).status){e.next=17;break}return e.next=12,c.json();case 12:i=e.sent,s=1e3*Number(l)-o,a({displayName:i.displayName,used:Number(i.used),limit:Number(i.total),photoLink:i.photoLink},s),e.next=18;break;case 17:n("Invalid authentication");case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(5),n(e.t0);case 23:e.next=27;break;case 25:console.log("Waiting"),t||setTimeout((function(){ve(!1,a,n)}),300);case 27:case"end":return e.stop()}}),e,null,[[5,20]])})))).apply(this,arguments)}function ke(){var e=Object(o.c)((function(e){return e.auth})),t=Ee(),a=Object(o.b)();return!1===e.status&&ve(!0,(function(e,t){a(i(e)),setTimeout((function(){alert("Token has expired. You will have to authorise again."),a({type:"LOGOUT"})}),t)}),(function(e){console.log("Error:"),console.log(e)})),e.status?n.createElement("div",null,n.createElement(y.a,{className:t.root},n.createElement(z,null),n.createElement(H,null),n.createElement("div",{style:{height:"1em"}}),n.createElement(ge,null))):n.createElement("div",null,n.createElement(y.a,{className:t.root},n.createElement(w.a,null,n.createElement("b",null,"Oh hi,")),n.createElement(w.a,null,"A microservice to quickly create copies of Google Drive files into your account. Inorder to use this service you will have to authenticate your Google account."),n.createElement("br",null),n.createElement("div",{className:t.authButton},n.createElement(x.a,{variant:"outlined",href:"https://lace-observation.glitch.me/auth/",target:"_blank",onClick:function(){window.localStorage.removeItem("dtoken"),ve(!1,(function(e){console.log(e),a(i(e))}),(function(e){console.log("Error:"),console.log(e)}))}},"Authorise"))))}var ye=document.getElementById("root");Object(l.render)(n.createElement(o.a,{store:g},n.createElement(ke,null)),ye)}},[[86,1,2]]]);
//# sourceMappingURL=main.93aec2ee.chunk.js.map